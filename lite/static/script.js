!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"earthRadius",(function(){return d})),r.d(n,"factors",(function(){return f})),r.d(n,"unitsFactors",(function(){return h})),r.d(n,"areaFactors",(function(){return g})),r.d(n,"feature",(function(){return p})),r.d(n,"geometry",(function(){return m})),r.d(n,"point",(function(){return w})),r.d(n,"points",(function(){return y})),r.d(n,"polygon",(function(){return E})),r.d(n,"polygons",(function(){return b})),r.d(n,"lineString",(function(){return v})),r.d(n,"lineStrings",(function(){return T})),r.d(n,"featureCollection",(function(){return _})),r.d(n,"multiLineString",(function(){return S})),r.d(n,"multiPoint",(function(){return M})),r.d(n,"multiPolygon",(function(){return P})),r.d(n,"geometryCollection",(function(){return A})),r.d(n,"round",(function(){return k})),r.d(n,"radiansToLength",(function(){return x})),r.d(n,"lengthToRadians",(function(){return L})),r.d(n,"lengthToDegrees",(function(){return I})),r.d(n,"bearingToAzimuth",(function(){return C})),r.d(n,"radiansToDegrees",(function(){return j})),r.d(n,"degreesToRadians",(function(){return q})),r.d(n,"convertLength",(function(){return O})),r.d(n,"convertArea",(function(){return N})),r.d(n,"isNumber",(function(){return B})),r.d(n,"isObject",(function(){return R})),r.d(n,"validateBBox",(function(){return D})),r.d(n,"validateId",(function(){return F})),r.d(n,"radians2degrees",(function(){return X})),r.d(n,"degrees2radians",(function(){return U})),r.d(n,"distanceToDegrees",(function(){return G})),r.d(n,"distanceToRadians",(function(){return Y})),r.d(n,"radiansToDistance",(function(){return Z})),r.d(n,"bearingToAngle",(function(){return z})),r.d(n,"convertDistance",(function(){return W}));var o={};r.r(o),r.d(o,"ContourRenderer",(function(){return V})),r.d(o,"toPoints",(function(){return H}));let i=function(e,t,r){this.figure=e,void 0===r&&(r=new Bokeh.ColumnDataSource({data:{x:[],y:[],dw:[],dh:[],image:[],level:[]}})),this.source=r,e.image({x:{field:"x"},y:{field:"y"},dw:{field:"dw"},dh:{field:"dh"},image:{field:"image"},source:this.source,color_mapper:t}),this.url="/tiles/dataset/time/{Z}/{X}/{Y}",fetch("/google_limits").then(e=>e.json()).then(e=>{this.limits=e}),this.tileCache={},this.imageCache={};let n=this.figure.x_range;n.connect(n.properties.start.change,()=>{this.render()})};i.prototype.setURL=function(e){if(e===this.url)return;this.url=e;let t=Object.keys(this.source.data).reduce((e,t)=>(e[t]=[],e),{});this.source.data=t,this.source.change.emit(),this.tileCache={},this.render()},i.prototype.render=function(){if(void 0===this.limits)return;let e=this.figure.x_range,t=this.figure.y_range,r=a(e,t,this.limits),n={remote:[],local:[]};for(let e=0;e<r.length;e++){let t=r[e],o=this.url.replace("{Z}",t.z).replace("{X}",t.x).replace("{Y}",t.y);o in this.tileCache||(this.tileCache[o]=!0,o in this.imageCache?n.local.push(o):n.remote.push(o))}let o=n.local.map(e=>this.imageCache[e]);o.length>0&&this._addImages(o),n.remote.forEach(e=>{fetch(e).then(e=>e.json()).then(t=>{this.imageCache[e]=t,this._addImage(t)})})},i.prototype._addImages=function(e){let t=this.source,r=this.splitImages(t.data).concat(e);r=r.sort((e,t)=>e.level[0]-t.level[0]);let n=this.mergeImages(r);t.data=n,t.change.emit()},i.prototype._addImage=function(e){let t=this.source,r=Object.keys(e).reduce((r,n)=>(r[n]=t.data[n].concat(e[n]),r),{}),n=this.splitImages(r);n=n.sort((e,t)=>e.level[0]-t.level[0]);let o=this.mergeImages(n);t.data=o,t.change.emit()},i.prototype.splitImages=function(e){return Object.keys(e).reduce((t,r)=>(e[r].forEach((e,n)=>{t[n]=t[n]||{},t[n][r]=[e]}),t),[])},i.prototype.mergeImages=function(e){return e.reduce((e,t)=>(Object.keys(t).forEach(r=>{e[r]=e[r]||[],e[r]=e[r].concat(t[r])}),e),{})};let a=function(e,t,r){let n=s(r.x[0],r.x[1],0,256),o=s(r.y[0],r.y[1],0,256),i={x:{start:n(e.start),end:n(e.end)},y:{start:o(t.start),end:o(t.end)}},a=c(i)+2,d={x:{start:u(l(i.x.start,a)),end:u(l(i.x.end,a))},y:{start:u(l(i.y.start,a)),end:u(l(i.y.end,a))}},f=[];for(let e=d.x.start;e<=d.x.end;e++)for(let t=d.y.start;t<=d.y.end;t++)f.push({z:a,x:e,y:t});return f},s=function(e,t,r,n){return function(o){return(n-r)*(o-e)/(t-e)}},l=function(e,t){return Math.floor(e*2**t)},u=function(e){return Math.floor(e/256)},c=function(e){let t=e.x.end-e.x.start,r=e.y.end-e.y.start,n=Math.min(t,r);return Math.floor(Math.log2(256/n))};var d=6371008.8,f={meters:d,metres:d,millimeters:1e3*d,millimetres:1e3*d,centimeters:100*d,centimetres:100*d,kilometers:d/1e3,kilometres:d/1e3,miles:d/1609.344,nauticalmiles:d/1852,inches:39.37*d,yards:d/1.0936,feet:3.28084*d,radians:1,degrees:d/111325},h={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/d,degrees:1/111325},g={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function p(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.bbox,o=r.id;if(void 0===e)throw new Error("geometry is required");if(t&&t.constructor!==Object)throw new Error("properties must be an Object");n&&D(n),o&&F(o);var i={type:"Feature"};return o&&(i.id=o),n&&(i.bbox=n),i.properties=t||{},i.geometry=e,i}function m(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n,o=r.bbox;if(!e)throw new Error("type is required");if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");switch(o&&D(o),e){case"Point":n=w(t).geometry;break;case"LineString":n=v(t).geometry;break;case"Polygon":n=E(t).geometry;break;case"MultiPoint":n=M(t).geometry;break;case"MultiLineString":n=S(t).geometry;break;case"MultiPolygon":n=P(t).geometry;break;default:throw new Error(e+" is invalid")}return o&&(n.bbox=o),n}function w(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!B(e[0])||!B(e[1]))throw new Error("coordinates must contain numbers");return p({type:"Point",coordinates:e},t,r)}function y(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return _(e.map((function(e){return w(e,t)})),r)}function E(e,t,r){if(!e)throw new Error("coordinates is required");for(var n=0;n<e.length;n++){var o=e[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<o[o.length-1].length;i++){if(0===n&&0===i&&!B(o[0][0])||!B(o[0][1]))throw new Error("coordinates must contain numbers");if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}}return p({type:"Polygon",coordinates:e},t,r)}function b(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return _(e.map((function(e){return E(e,t)})),r)}function v(e,t,r){if(!e)throw new Error("coordinates is required");if(e.length<2)throw new Error("coordinates must be an array of two or more positions");if(!B(e[0][1])||!B(e[0][1]))throw new Error("coordinates must contain numbers");return p({type:"LineString",coordinates:e},t,r)}function T(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return _(e.map((function(e){return v(e,t)})),r)}function _(e,t){if(!R(t=t||{}))throw new Error("options is invalid");var r=t.bbox,n=t.id;if(!e)throw new Error("No features passed");if(!Array.isArray(e))throw new Error("features must be an Array");r&&D(r),n&&F(n);var o={type:"FeatureCollection"};return n&&(o.id=n),r&&(o.bbox=r),o.features=e,o}function S(e,t,r){if(!e)throw new Error("coordinates is required");return p({type:"MultiLineString",coordinates:e},t,r)}function M(e,t,r){if(!e)throw new Error("coordinates is required");return p({type:"MultiPoint",coordinates:e},t,r)}function P(e,t,r){if(!e)throw new Error("coordinates is required");return p({type:"MultiPolygon",coordinates:e},t,r)}function A(e,t,r){if(!e)throw new Error("geometries is required");if(!Array.isArray(e))throw new Error("geometries must be an Array");return p({type:"GeometryCollection",geometries:e},t,r)}function k(e,t){if(null==e||isNaN(e))throw new Error("num is required");if(t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function x(e,t){if(null==e)throw new Error("radians is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var r=f[t||"kilometers"];if(!r)throw new Error(t+" units is invalid");return e*r}function L(e,t){if(null==e)throw new Error("distance is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var r=f[t||"kilometers"];if(!r)throw new Error(t+" units is invalid");return e/r}function I(e,t){return j(L(e,t))}function C(e){if(null==e)throw new Error("bearing is required");var t=e%360;return t<0&&(t+=360),t}function j(e){if(null==e)throw new Error("radians is required");return 180*(e%(2*Math.PI))/Math.PI}function q(e){if(null==e)throw new Error("degrees is required");return e%360*Math.PI/180}function O(e,t,r){if(null==e)throw new Error("length is required");if(!(e>=0))throw new Error("length must be a positive number");return x(L(e,t),r||"kilometers")}function N(e,t,r){if(null==e)throw new Error("area is required");if(!(e>=0))throw new Error("area must be a positive number");var n=g[t||"meters"];if(!n)throw new Error("invalid original units");var o=g[r||"kilometers"];if(!o)throw new Error("invalid final units");return e/n*o}function B(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function R(e){return!!e&&e.constructor===Object}function D(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!B(e))throw new Error("bbox must only contain numbers")}))}function F(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}function X(){throw new Error("method has been renamed to `radiansToDegrees`")}function U(){throw new Error("method has been renamed to `degreesToRadians`")}function G(){throw new Error("method has been renamed to `lengthToDegrees`")}function Y(){throw new Error("method has been renamed to `lengthToRadians`")}function Z(){throw new Error("method has been renamed to `radiansToLength`")}function z(){throw new Error("method has been renamed to `bearingToAzimuth`")}function W(){throw new Error("method has been renamed to `convertLength`")}const V=function(e,t){t.connect(t.properties.data.change,()=>{console.log("ContourRenderer")})},H=e=>{let t=[],r=e.dw/e.image.length,n=e.dh/e.image[0].length;for(let o=0;o<e.image.length;o++)for(let i=0;i<e.image[o].length;i++){let a=e.image[o][i],s=e.x+(.5+o)*r,l=e.y+(.5+i)*n;t.push(w([s,l],{value:a}))}return t};function J(e,t,r){if(null!==e)for(var n,o,i,a,s,l,u,c,d=0,f=0,h=e.type,g="FeatureCollection"===h,p="Feature"===h,m=g?e.features.length:1,w=0;w<m;w++){s=(c=!!(u=g?e.features[w].geometry:p?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var y=0;y<s;y++){var E=0,b=0;if(null!==(a=c?u.geometries[y]:u)){l=a.coordinates;var v=a.type;switch(d=!r||"Polygon"!==v&&"MultiPolygon"!==v?0:1,v){case null:break;case"Point":t(l,f,w,E,b),f++,E++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++)t(l[n],f,w,E,b),f++,"MultiPoint"===v&&E++;"LineString"===v&&E++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(o=0;o<l[n].length-d;o++)t(l[n][o],f,w,E,b),f++;"MultiLineString"===v&&E++,"Polygon"===v&&b++}"Polygon"===v&&E++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for("MultiPolygon"===v&&(b=0),o=0;o<l[n].length;o++){for(i=0;i<l[n][o].length-d;i++)t(l[n][o][i],f,w,E,b),f++;b++}E++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)J(a.geometries[n],t,r);break;default:throw new Error("Unknown Geometry Type")}}}}}function $(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)t(e.features[r],r)}var K=function(e){var t=[1/0,1/0,-1/0,-1/0];return J(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t};function Q(e){if(!e)throw new Error("obj is required");var t=ee(e);if(t.length>1&&B(t[0])&&B(t[1]))return t;throw new Error("Coordinate is not a valid Point")}function ee(e){if(!e)throw new Error("obj is required");var t;if(e.length?t=e:e.coordinates?t=e.coordinates:e.geometry&&e.geometry.coordinates&&(t=e.geometry.coordinates),t)return function e(t){if(t.length>1&&B(t[0])&&B(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return e(t[0]);throw new Error("coordinates must only contain numbers")}(t),t;throw new Error("No valid coordinates")}function te(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0;n<e.features.length;n++){var o=e.features[n];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+o.geometry.type)}}function re(e){if(!e)throw new Error("geojson is required");if(void 0!==e.geometry)return e.geometry;if(e.coordinates||e.geometries)return e;throw new Error("geojson must be a valid Feature or Geometry Object")}function ne(e,t){if(!e)throw new Error((t||"geojson")+" is required");if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error((t||"geojson")+" is invalid")}
/**
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 */var oe={successCallback:null,verbose:!1},ie={};function ae(e,t,r){r=r||{};for(var n=Object.keys(oe),o=0;o<n.length;o++){var i=n[o],a=r[i];a=null!=a?a:oe[i],ie[i]=a}ie.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+t);var s=function(e){var t=[],r=0;e.rows,e.cols;return e.cells.forEach((function(n,o){n.forEach((function(n,i){if(void 0!==n&&(5!==(f=n).cval&&10!==f.cval)&&!le(n)){var a=function(e,t,r){var n,o,i,a=e.length,s=[],l=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],u=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],c=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],d=(e[t][r],e[t][r]),f=d.cval,h=ce(d,i=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][f]);s.push([r+h[0],t+h[1]]),h=ce(d,i=c[f]),s.push([r+h[0],t+h[1]]),ue(d);var g=r+l[f],p=t+u[f],m=f;for(;g>=0&&p>=0&&p<a&&(g!=r||p!=t)&&void 0!==(d=e[p][g]);){if(0===(f=d.cval)||15===f)return{path:s,info:"mergeable"};i=c[f],n=l[f],o=u[f],5!==f&&10!==f||(5===f?d.flipped?-1===u[m]?(i="left",n=-1,o=0):(i="right",n=1,o=0):-1===l[m]&&(i="bottom",n=0,o=-1):10===f&&(d.flipped?-1===l[m]?(i="top",n=0,o=1):(i="bottom",n=0,o=-1):1===u[m]&&(i="left",n=-1,o=0))),h=ce(d,i),s.push([g+h[0],p+h[1]]),ue(d),g+=n,p+=o,m=f}return{path:s,info:"closed"}}(e.cells,o,i),s=!1;if("mergeable"===a.info)for(var l=a.path[a.path.length-1][0],u=a.path[a.path.length-1][1],c=r-1;c>=0;c--)if(Math.abs(t[c][0][0]-l)<=1e-7&&Math.abs(t[c][0][1]-u)<=1e-7){for(var d=a.path.length-2;d>=0;--d)t[c].unshift(a.path[d]);s=!0;break}s||(t[r++]=a.path)}var f}))})),t}(function(e,t){for(var r=e.length-1,n=e[0].length-1,o={rows:r,cols:n,cells:[]},i=0;i<r;++i){o.cells[i]=[];for(var a=0;a<n;++a){var s=0,l=e[i+1][a],u=e[i+1][a+1],c=e[i][a+1],d=e[i][a];if(!(isNaN(l)||isNaN(u)||isNaN(c)||isNaN(d))){s|=l>=t?8:0,s|=u>=t?4:0,s|=c>=t?2:0;var f,h,g,p,m=!1;if(5===(s|=d>=t?1:0)||10===s){var w=(l+u+c+d)/4;5===s&&w<t?(s=10,m=!0):10===s&&w<t&&(s=5,m=!0)}if(0!==s&&15!==s)f=h=g=p=.5,1===s?(g=1-se(t,l,d),h=1-se(t,c,d)):2===s?(h=se(t,d,c),p=1-se(t,u,c)):3===s?(g=1-se(t,l,d),p=1-se(t,u,c)):4===s?(f=se(t,l,u),p=se(t,c,u)):5===s?(f=se(t,l,u),p=se(t,c,u),h=1-se(t,c,d),g=1-se(t,l,d)):6===s?(h=se(t,d,c),f=se(t,l,u)):7===s?(g=1-se(t,l,d),f=se(t,l,u)):8===s?(g=se(t,d,l),f=1-se(t,u,l)):9===s?(h=1-se(t,c,d),f=1-se(t,u,l)):10===s?(f=1-se(t,u,l),p=1-se(t,u,c),h=se(t,d,c),g=se(t,d,l)):11===s?(f=1-se(t,u,l),p=1-se(t,u,c)):12===s?(g=se(t,d,l),p=se(t,c,u)):13===s?(h=1-se(t,c,d),p=se(t,c,u)):14===s?(g=se(t,d,l),h=se(t,d,c)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+s),o.cells[i][a]={cval:s,flipped:m,top:f,right:p,bottom:h,left:g}}}}return o}(e,t));return"function"==typeof ie.successCallback&&ie.successCallback(s),s}function se(e,t,r){return(e-t)/(r-t)}function le(e){return 0===e.cval||15===e.cval}function ue(e){le(e)||5===e.cval||10===e.cval||(e.cval=15)}function ce(e,t){return"top"===t?[e.top,1]:"bottom"===t?[e.bottom,0]:"right"===t?[1,e.right]:"left"===t?[0,e.left]:void 0}function de(e,t){if(!R(t=t||{}))throw new Error("options is invalid");var r=t.zProperty||"elevation",n=t.flip,o=t.flags;te(e,"Point","input must contain Points");for(var i=function(e,t){var r={};return $(e,(function(e){var t=ee(e)[1];r[t]||(r[t]=[]),r[t].push(e)})),Object.keys(r).map((function(e){return r[e].sort((function(e,t){return ee(e)[0]-ee(t)[0]}))})).sort((function(e,r){return t?ee(e[0])[1]-ee(r[0])[1]:ee(r[0])[1]-ee(e[0])[1]}))}(e,n),a=[],s=0;s<i.length;s++){for(var l=i[s],u=[],c=0;c<l.length;c++){var d=l[c];d.properties[r]?u.push(d.properties[r]):u.push(0),!0===o&&(d.properties.matrixPosition=[s,c])}a.push(u)}return a}var fe=function(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.zProperty||"elevation",o=r.commonProperties||{},i=r.breaksProperties||[];if(te(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks must be an Array");if(!R(o))throw new Error("commonProperties must be an Object");if(!Array.isArray(i))throw new Error("breaksProperties must be an Array");var a=de(e,{zProperty:n,flip:!0});return _(function(e,t,r){var n=K(r),o=n[2]-n[0],i=n[3]-n[1],a=n[0],s=n[1],l=t[0].length-1,u=t.length-1,c=o/l,d=i/u,f=function(e){e[0]=e[0]*c+a,e[1]=e[1]*d+s};return e.forEach((function(e){J(e,f)})),e}(function(e,t,r,n,o){for(var i=[],a=1;a<t.length;a++){var s=+t[a],l=Object.assign({},n,o[a]);l[r]=s;var u=S(ae(e,s),l);i.push(u)}return i}(a,t,n,o,i),a,e))};function he(e,t,r,n){var o=r[0],i=r[1],a=e[0],s=e[1],l=t[0],u=t[1],c=l-a,d=u-s;return 0==(r[0]-a)*d-(r[1]-s)*c&&(n?"start"===n?Math.abs(c)>=Math.abs(d)?c>0?a<o&&o<=l:l<=o&&o<a:d>0?s<i&&i<=u:u<=i&&i<s:"end"===n?Math.abs(c)>=Math.abs(d)?c>0?a<=o&&o<l:l<o&&o<=a:d>0?s<=i&&i<u:u<i&&i<=s:"both"===n?Math.abs(c)>=Math.abs(d)?c>0?a<o&&o<l:l<o&&o<a:d>0?s<i&&i<u:u<i&&i<s:void 0:Math.abs(c)>=Math.abs(d)?c>0?a<=o&&o<=l:l<=o&&o<=a:d>0?s<=i&&i<=u:u<=i&&i<=s)}var ge=function(e,t,r){var n=(r=r||{}).ignoreEndVertices;if(!R(r))throw new Error("invalid options");if(!e)throw new Error("pt is required");if(!t)throw new Error("line is required");for(var o=Q(e),i=ee(t),a=0;a<i.length-1;a++){var s=!1;if(n&&(0===a&&(s="start"),a===i.length-2&&(s="end"),0===a&&a+1===i.length-1&&(s="both")),he(i[a],i[a+1],o,s))return!0}return!1};function pe(e,t,r){var n=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,i=t.length-1;o<t.length;i=o++){var a=t[o][0],s=t[o][1],l=t[i][0],u=t[i][1];if(e[1]*(a-l)+s*(l-e[0])+u*(e[0]-a)==0&&(a-e[0])*(l-e[0])<=0&&(s-e[1])*(u-e[1])<=0)return!r;s>e[1]!=u>e[1]&&e[0]<(l-a)*(e[1]-s)/(u-s)+a&&(n=!n)}return n}var me=function(e,t,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.ignoreBoundary;if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var o=Q(e),i=ee(t),a=t.geometry?t.geometry.type:t.type,s=t.bbox;if(s&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(o,s))return!1;"Polygon"===a&&(i=[i]);for(var l=0,u=!1;l<i.length&&!u;l++)if(pe(o,i[l][0],n)){for(var c=!1,d=1;d<i[l].length&&!c;)pe(o,i[l][d],!n)&&(c=!0),d++;c||(u=!0)}return u};function we(e,t){return!(e[0]>t[0])&&(!(e[2]<t[2])&&(!(e[1]>t[1])&&!(e[3]<t[3])))}function ye(e,t){return e[0]===t[0]&&e[1]===t[1]}var Ee=function(e,t){var r=ne(e),n=ne(t),o=re(e),i=re(t);switch(r){case"Point":switch(n){case"MultiPoint":return function(e,t){var r,n=!1;for(r=0;r<t.coordinates.length;r++)if(ye(t.coordinates[r],e.coordinates)){n=!0;break}return n}(o,i);case"LineString":return ge(o,i,{ignoreEndVertices:!0});case"Polygon":return me(o,i,{ignoreBoundary:!0});default:throw new Error("feature2 "+n+" geometry not supported")}case"MultiPoint":switch(n){case"MultiPoint":return function(e,t){for(var r=0;r<e.coordinates.length;r++){for(var n=!1,o=0;o<t.coordinates.length;o++)ye(e.coordinates[r],t.coordinates[o])&&(n=!0);if(!n)return!1}return!0}(o,i);case"LineString":return function(e,t){for(var r=!1,n=0;n<e.coordinates.length;n++){if(!ge(e.coordinates[n],t))return!1;r||(r=ge(e.coordinates[n],t,{ignoreEndVertices:!0}))}return r}(o,i);case"Polygon":return function(e,t){for(var r=!0,n=0;n<e.coordinates.length;n++){var o=me(e.coordinates[1],t);if(!o){r=!1;break}o=me(e.coordinates[1],t,{ignoreBoundary:!0})}return r&&o}(o,i);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"LineString":return function(e,t){for(var r=0;r<e.coordinates.length;r++)if(!ge(e.coordinates[r],t))return!1;return!0}(o,i);case"Polygon":return function(e,t){var r=K(t),n=K(e);if(!we(r,n))return!1;for(var o=!1,i=0;i<e.coordinates.length-1;i++){if(!me(e.coordinates[i],t))return!1;if(o||(o=me(e.coordinates[i],t,{ignoreBoundary:!0})),!o){var a=(s=e.coordinates[i],l=e.coordinates[i+1],[(s[0]+l[0])/2,(s[1]+l[1])/2]);o=me(a,t,{ignoreBoundary:!0})}}var s,l;return o}(o,i);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"Polygon":return function(e,t){var r=K(e);if(!we(K(t),r))return!1;for(var n=0;n<e.coordinates[0].length;n++)if(!me(e.coordinates[0][n],t))return!1;return!0}(o,i);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}};var be=function(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.units,o=Q(e),i=Q(t),a=q(i[1]-o[1]),s=q(i[0]-o[0]),l=q(o[1]),u=q(i[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(u);return x(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n)};var ve=function(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.mask,o=r.properties,i=[];if(null==t)throw new Error("cellSide is required");if(!B(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(n&&-1===["Polygon","MultiPolygon"].indexOf(ne(n)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=e[0],s=e[1],l=e[2],u=e[3],c=t/be([a,s],[l,s],r)*(l-a),d=t/be([a,s],[a,u],r)*(u-s),f=l-a,h=u-s,g=Math.floor(f/c),p=(h-Math.floor(h/d)*d)/2,m=a+(f-g*c)/2;m<=l;){for(var y=s+p;y<=u;){var E=w([m,y],o);n?Ee(E,n)&&i.push(E):i.push(E),y+=d}m+=c}return _(i)};window.isolines=fe,window.pointGrid=ve,window.helpers=n,window.contour=o;let Te={Antique:"https://cartocdn_d.global.ssl.fastly.net/base-antique/{Z}/{X}/{Y}.png","Midnight Commander":"https://cartocdn_d.global.ssl.fastly.net/base-midnight/{Z}/{X}/{Y}.png","ESRI Nat Geo":"https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{Z}/{Y}/{X}",Voyager:"https://d.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{Z}/{X}/{Y}.png"};let _e=e=>({type:"SET_PALETTE",payload:e}),Se=e=>({type:"SET_PALETTE_NAME",payload:e}),Me=e=>({type:"SET_PALETTE_NUMBER",payload:e}),Pe=e=>({type:"SET_TIME_INDEX",payload:e}),Ae=(e="",t)=>{switch(t.type){case"SET_DATASET":return Object.assign({},e,{dataset:t.payload});case"SET_DATASETS":return Object.assign({},e,{datasets:t.payload});case"SET_URL":return Object.assign({},e,{url:t.payload});case"SET_PALETTE":return Object.assign({},e,{palette:t.payload});case"SET_PALETTES":return Object.assign({},e,{palettes:t.payload});case"SET_PALETTE_NAME":return Object.assign({},e,{palette_name:t.payload});case"SET_PALETTE_NAMES":return Object.assign({},e,{palette_names:t.payload});case"SET_PALETTE_NUMBER":return Object.assign({},e,{palette_number:t.payload});case"SET_PALETTE_NUMBERS":return Object.assign({},e,{palette_numbers:t.payload});case"SET_PLAYING":return Object.assign({},e,{playing:t.payload});case"SET_LIMITS":return Object.assign({},e,{limits:t.payload});case"SET_TIMES":return Object.assign({},e,{times:t.payload});case"SET_TIME_INDEX":return Object.assign({},e,{time_index:t.payload});case"FETCH_IMAGE":return Object.assign({},e,{is_fetching:!0,image_url:t.payload});case"FETCH_IMAGE_SUCCESS":return Object.assign({},e,{is_fetching:!1});default:return e}},ke=e=>e=>t=>{e(t)},xe=e=>t=>r=>{if("NEXT_TIME_INDEX"===r.type){let r=e.getState();if(void 0===r.time_index)return;if(void 0===r.times)return;let n=Ce(r.time_index+1,r.times.length),o=Pe(n);t(o)}else if("PREVIOUS_TIME_INDEX"===r.type){let r=e.getState();if(void 0===r.time_index)return;if(void 0===r.times)return;let n=Ce(r.time_index-1,r.times.length),o=Pe(n);t(o)}else t(r)},Le=e=>t=>r=>{if("SET_PALETTE_NAME"==r.type){let t=r.payload,n=e.getState();if(void 0!==n.palettes){let r=n.palettes.filter(e=>e.name==t).map(e=>parseInt(e.number)).concat().sort((e,t)=>e-t),o={type:"SET_PALETTE_NUMBERS",payload:r};e.dispatch(o)}}else if("SET_PALETTE_NUMBER"==r.type){let t=e.getState(),n=t.palette_name,o=r.payload;if(void 0!==t.palettes){let r=je(t.palettes,n,o);if(r.length>0){let t=_e(r[0].palette);e.dispatch(t)}}}else if("SET_PALETTES"==r.type){t(r),t(Se("Blues")),t(Me(256));let e=je(r.payload,"Blues",256);if(e.length>0){let r=_e(e[0].palette);t(r)}return}return t(r)},Ie=e=>e=>t=>{if(e(t),"SET_DATASETS"==t.type){let r=t.payload[0];e((e=>({type:"SET_DATASET",payload:e}))(r))}},Ce=function(e,t){return(e%t+t)%t},je=function(e,t,r){return e.filter(e=>e.name===t).filter(e=>parseInt(e.number)===parseInt(r))};function qe(e,t){this.figure=e,this.source=new Bokeh.ColumnDataSource({data:{xs:[[]],ys:[[]]}}),this.figure.multi_line({xs:{field:"xs"},ys:{field:"ys"},line_color:t,source:this.source})}function Oe(e){this.el=e}function Ne(e){this.button=document.createElement("button"),this.button.classList.add("lite-btn","play-btn"),this.i=document.createElement("i"),this.i.classList.add("fas","fa-play"),this.button.appendChild(this.i),this.button.onclick=e.onClick,this.el=this.button}function Be(e){let t,r;t=document.createElement("button"),t.classList.add("lite-btn","previous-btn"),t.onclick=e.onClick,r=document.createElement("i"),r.classList.add("fas","fa-angle-left"),t.appendChild(r),this.el=t}function Re(e){let t,r;t=document.createElement("button"),t.classList.add("lite-btn","next-btn"),t.onclick=e.onClick,r=document.createElement("i"),r.classList.add("fas","fa-angle-right"),t.appendChild(r),this.el=t}window.main=function(){let e=new Bokeh.Range1d({start:0,end:1e6}),t=new Bokeh.Range1d({start:0,end:1e6}),r=Bokeh.Plotting.figure({x_range:e,y_range:t,sizing_mode:"stretch_both"});r.xaxis[0].visible=!1,r.yaxis[0].visible=!1,r.toolbar_location=null,r.min_border=0,r.select_one(Bokeh.WheelZoomTool).active=!0;let n=new Bokeh.WMTSTileSource({url:"https://cartocdn_d.global.ssl.fastly.net/base-antique/{Z}/{X}/{Y}.png"}),o=new Bokeh.TileRenderer({tile_source:n});r.renderers=r.renderers.concat(o),Bokeh.Plotting.show(r,"#map-figure");let a=Redux.createStore(Ae,Redux.applyMiddleware(ke,xe,Le,Ie));a.subscribe(()=>{let e=a.getState();void 0!==e.url&&(n.url=e.url)}),fetch("./palettes").then(e=>e.json()).then(e=>{let t={type:"SET_PALETTES",payload:e};return a.dispatch(t),e}).then(e=>{let t=e.map(e=>e.name);return Array.from(new Set(t)).concat().sort()}).then(e=>{let t={type:"SET_PALETTE_NAMES",payload:e};a.dispatch(t)});let s=new Bokeh.Widgets.Select({options:Object.keys(Te)});s.connect(s.properties.value.change,()=>{a.dispatch({type:"SET_URL",payload:Te[s.value]})}),Bokeh.Plotting.show(s,"#tile-url-select");let l=new Bokeh.Widgets.Select({options:[]});l.connect(l.properties.value.change,()=>{a.dispatch({type:"SET_DATASET",payload:l.value})}),Bokeh.Plotting.show(l,"#select"),a.subscribe(()=>{let e=a.getState();void 0!==e.datasets&&void 0!==e.dataset&&(l.options=e.datasets,l.value=e.dataset)}),fetch("./datasets").then(e=>e.json()).then(e=>{a.dispatch({type:"SET_DATASETS",payload:e.names})});let u=new Bokeh.Widgets.Select({options:[]});a.subscribe(()=>{let e=a.getState();void 0!==e.palette_names&&(u.options=e.palette_names)}),u.connect(u.properties.value.change,()=>{let e=Se(u.value);a.dispatch(e)}),Bokeh.Plotting.show(u,"#palette-select");let c=new Bokeh.Widgets.Select({options:[]});a.subscribe(()=>{let e=a.getState();if(void 0!==e.palette_numbers){let t=e.palette_numbers.map(e=>e.toString());c.options=t}}),c.connect(c.properties.value.change,()=>{let e=Me(c.value);a.dispatch(e)}),Bokeh.Plotting.show(c,"#palette-number-select");let d=new Bokeh.LinearColorMapper({low:200,high:300,palette:["#440154","#208F8C","#FDE724"],nan_color:"rgba(0,0,0,0)"});a.subscribe(()=>{let e=a.getState();void 0!==e.palette&&(d.palette=e.palette),void 0!==e.limits&&(d.low=e.limits.low,d.high=e.limits.high)});let f=new i(r,d);a.subscribe(()=>{let e=a.getState();if(void 0===e.dataset)return;if(void 0===e.time_index)return;if(void 0===e.times)return;let t=e.times[e.time_index],r=`./tiles/${e.dataset}/${t}/{Z}/{X}/{Y}`;f.setURL(r)});let h=new V(r,f.source);console.log(h);let g=new Oe(document.getElementById("title-text"));a.subscribe(()=>{let e=a.getState();if(void 0===e.time_index)return;if(void 0===e.times)return;let t=new Date(e.times[e.time_index]);g.render(t.toUTCString())}),a.dispatch(Pe(0)),fetch("./datasets/EIDA50/times?limit=10").then(e=>e.json()).then(e=>{let t={type:"SET_TIMES",payload:e};a.dispatch(t)});let p=()=>{let e=a.getState();if(!e.is_fetching&&e.playing){let e={type:"NEXT_TIME_INDEX"};a.dispatch(e)}},m=document.getElementById("controls"),w=document.createElement("div");w.classList.add("btn-row"),m.appendChild(w);let y=new Be({onClick:()=>{let e={type:"PREVIOUS_TIME_INDEX"};a.dispatch(e)}});w.appendChild(y.el);let E=new Ne({onClick:function(){let e;e=!a.getState().playing;let t=(e=>({type:"SET_PLAYING",payload:e}))(e);a.dispatch(t)}});a.subscribe(()=>{let e=a.getState();E.render(e.playing)}),w.appendChild(E.el);let b=new Re({onClick:()=>{let e={type:"NEXT_TIME_INDEX"};a.dispatch(e)}});w.appendChild(b.el);p(),setInterval(p,100),new qe(r,"black").fetch("./atlas/coastlines"),new qe(r,"black").fetch("./atlas/borders"),new qe(r,"red").fetch("./atlas/disputed"),new qe(r,"LightBlue").fetch("./atlas/lakes")},qe.prototype.fetch=function(e){fetch(e).then(e=>e.json()).then(e=>{this.source.data=e})},Oe.prototype.render=function(e){this.el.innerHTML=e},Ne.prototype.render=function(e){e?(this.i.classList.remove("fas","fa-play"),this.i.classList.add("fas","fa-pause")):(this.i.classList.remove("fas","fa-pause"),this.i.classList.add("fas","fa-play"))}}]);