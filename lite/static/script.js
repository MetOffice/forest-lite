!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"earthRadius",(function(){return d})),r.d(n,"factors",(function(){return h})),r.d(n,"unitsFactors",(function(){return g})),r.d(n,"areaFactors",(function(){return p})),r.d(n,"feature",(function(){return m})),r.d(n,"geometry",(function(){return y})),r.d(n,"point",(function(){return w})),r.d(n,"points",(function(){return b})),r.d(n,"polygon",(function(){return E})),r.d(n,"polygons",(function(){return v})),r.d(n,"lineString",(function(){return S})),r.d(n,"lineStrings",(function(){return T})),r.d(n,"featureCollection",(function(){return _})),r.d(n,"multiLineString",(function(){return M})),r.d(n,"multiPoint",(function(){return P})),r.d(n,"multiPolygon",(function(){return A})),r.d(n,"geometryCollection",(function(){return k})),r.d(n,"round",(function(){return x})),r.d(n,"radiansToLength",(function(){return j})),r.d(n,"lengthToRadians",(function(){return I})),r.d(n,"lengthToDegrees",(function(){return L})),r.d(n,"bearingToAzimuth",(function(){return C})),r.d(n,"radiansToDegrees",(function(){return O})),r.d(n,"degreesToRadians",(function(){return q})),r.d(n,"convertLength",(function(){return N})),r.d(n,"convertArea",(function(){return B})),r.d(n,"isNumber",(function(){return D})),r.d(n,"isObject",(function(){return R})),r.d(n,"validateBBox",(function(){return F})),r.d(n,"validateId",(function(){return G})),r.d(n,"radians2degrees",(function(){return X})),r.d(n,"degrees2radians",(function(){return U})),r.d(n,"distanceToDegrees",(function(){return z})),r.d(n,"distanceToRadians",(function(){return Y})),r.d(n,"radiansToDistance",(function(){return W})),r.d(n,"bearingToAngle",(function(){return Z})),r.d(n,"convertDistance",(function(){return J}));var o={};r.r(o),r.d(o,"toMercator",(function(){return ee})),r.d(o,"toWgs84",(function(){return te}));var i={};r.r(i),r.d(i,"ContourRenderer",(function(){return Ee})),r.d(i,"toPoints",(function(){return ve}));let a=function(e,t,r){this.figure=e,void 0===r&&(r=new Bokeh.ColumnDataSource({data:{x:[],y:[],dw:[],dh:[],image:[],level:[]}})),this.source=r,e.image({x:{field:"x"},y:{field:"y"},dw:{field:"dw"},dh:{field:"dh"},image:{field:"image"},source:this.source,color_mapper:t}),this.url="/tiles/dataset/time/{Z}/{X}/{Y}",fetch("/google_limits").then(e=>e.json()).then(e=>{this.limits=e}),this.tileCache={},this.imageCache={};let n=this.figure.x_range;n.connect(n.properties.start.change,()=>{this.render()})};a.prototype.setURL=function(e){if(e===this.url)return;this.url=e;let t=Object.keys(this.source.data).reduce((e,t)=>(e[t]=[],e),{});this.source.data=t,this.source.change.emit(),this.tileCache={},this.render()},a.prototype.render=function(){if(void 0===this.limits)return;let e=this.figure.x_range,t=this.figure.y_range,r=s(e,t,this.limits),n={remote:[],local:[]};for(let e=0;e<r.length;e++){let t=r[e],o=this.url.replace("{Z}",t.z).replace("{X}",t.x).replace("{Y}",t.y);o in this.tileCache||(this.tileCache[o]=!0,o in this.imageCache?n.local.push(o):n.remote.push(o))}let o=n.local.map(e=>this.imageCache[e]);o.length>0&&this._addImages(o),n.remote.forEach(e=>{fetch(e).then(e=>e.json()).then(t=>{this.imageCache[e]=t,this._addImage(t)})})},a.prototype._addImages=function(e){let t=this.source,r=this.splitImages(t.data).concat(e);r=r.sort((e,t)=>e.level[0]-t.level[0]);let n=this.mergeImages(r);t.data=n,t.change.emit()},a.prototype._addImage=function(e){let t=this.source,r=Object.keys(e).reduce((r,n)=>(r[n]=t.data[n].concat(e[n]),r),{}),n=this.splitImages(r);n=n.sort((e,t)=>e.level[0]-t.level[0]);let o=this.mergeImages(n);t.data=o,t.change.emit()},a.prototype.splitImages=function(e){return Object.keys(e).reduce((t,r)=>(e[r].forEach((e,n)=>{t[n]=t[n]||{},t[n][r]=[e]}),t),[])},a.prototype.mergeImages=function(e){return e.reduce((e,t)=>(Object.keys(t).forEach(r=>{e[r]=e[r]||[],e[r]=e[r].concat(t[r])}),e),{})};let s=function(e,t,r){let n=u(r.x[0],r.x[1],0,256),o=u(r.y[0],r.y[1],0,256),i={x:{start:n(e.start),end:n(e.end)},y:{start:o(t.start),end:o(t.end)}},a=f(i)+2,s={x:{start:c(l(i.x.start,a)),end:c(l(i.x.end,a))},y:{start:c(l(i.y.start,a)),end:c(l(i.y.end,a))}},d=[];for(let e=s.x.start;e<=s.x.end;e++)for(let t=s.y.start;t<=s.y.end;t++)d.push({z:a,x:e,y:t});return d},u=function(e,t,r,n){return function(o){return(n-r)*(o-e)/(t-e)}},l=function(e,t){return Math.floor(e*2**t)},c=function(e){return Math.floor(e/256)},f=function(e){let t=e.x.end-e.x.start,r=e.y.end-e.y.start,n=Math.min(t,r);return Math.floor(Math.log2(256/n))};var d=6371008.8,h={meters:d,metres:d,millimeters:1e3*d,millimetres:1e3*d,centimeters:100*d,centimetres:100*d,kilometers:d/1e3,kilometres:d/1e3,miles:d/1609.344,nauticalmiles:d/1852,inches:39.37*d,yards:d/1.0936,feet:3.28084*d,radians:1,degrees:d/111325},g={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/d,degrees:1/111325},p={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function m(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.bbox,o=r.id;if(void 0===e)throw new Error("geometry is required");if(t&&t.constructor!==Object)throw new Error("properties must be an Object");n&&F(n),o&&G(o);var i={type:"Feature"};return o&&(i.id=o),n&&(i.bbox=n),i.properties=t||{},i.geometry=e,i}function y(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n,o=r.bbox;if(!e)throw new Error("type is required");if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");switch(o&&F(o),e){case"Point":n=w(t).geometry;break;case"LineString":n=S(t).geometry;break;case"Polygon":n=E(t).geometry;break;case"MultiPoint":n=P(t).geometry;break;case"MultiLineString":n=M(t).geometry;break;case"MultiPolygon":n=A(t).geometry;break;default:throw new Error(e+" is invalid")}return o&&(n.bbox=o),n}function w(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!D(e[0])||!D(e[1]))throw new Error("coordinates must contain numbers");return m({type:"Point",coordinates:e},t,r)}function b(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return _(e.map((function(e){return w(e,t)})),r)}function E(e,t,r){if(!e)throw new Error("coordinates is required");for(var n=0;n<e.length;n++){var o=e[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<o[o.length-1].length;i++){if(0===n&&0===i&&!D(o[0][0])||!D(o[0][1]))throw new Error("coordinates must contain numbers");if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}}return m({type:"Polygon",coordinates:e},t,r)}function v(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return _(e.map((function(e){return E(e,t)})),r)}function S(e,t,r){if(!e)throw new Error("coordinates is required");if(e.length<2)throw new Error("coordinates must be an array of two or more positions");if(!D(e[0][1])||!D(e[0][1]))throw new Error("coordinates must contain numbers");return m({type:"LineString",coordinates:e},t,r)}function T(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return _(e.map((function(e){return S(e,t)})),r)}function _(e,t){if(!R(t=t||{}))throw new Error("options is invalid");var r=t.bbox,n=t.id;if(!e)throw new Error("No features passed");if(!Array.isArray(e))throw new Error("features must be an Array");r&&F(r),n&&G(n);var o={type:"FeatureCollection"};return n&&(o.id=n),r&&(o.bbox=r),o.features=e,o}function M(e,t,r){if(!e)throw new Error("coordinates is required");return m({type:"MultiLineString",coordinates:e},t,r)}function P(e,t,r){if(!e)throw new Error("coordinates is required");return m({type:"MultiPoint",coordinates:e},t,r)}function A(e,t,r){if(!e)throw new Error("coordinates is required");return m({type:"MultiPolygon",coordinates:e},t,r)}function k(e,t,r){if(!e)throw new Error("geometries is required");if(!Array.isArray(e))throw new Error("geometries must be an Array");return m({type:"GeometryCollection",geometries:e},t,r)}function x(e,t){if(null==e||isNaN(e))throw new Error("num is required");if(t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function j(e,t){if(null==e)throw new Error("radians is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var r=h[t||"kilometers"];if(!r)throw new Error(t+" units is invalid");return e*r}function I(e,t){if(null==e)throw new Error("distance is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var r=h[t||"kilometers"];if(!r)throw new Error(t+" units is invalid");return e/r}function L(e,t){return O(I(e,t))}function C(e){if(null==e)throw new Error("bearing is required");var t=e%360;return t<0&&(t+=360),t}function O(e){if(null==e)throw new Error("radians is required");return 180*(e%(2*Math.PI))/Math.PI}function q(e){if(null==e)throw new Error("degrees is required");return e%360*Math.PI/180}function N(e,t,r){if(null==e)throw new Error("length is required");if(!(e>=0))throw new Error("length must be a positive number");return j(I(e,t),r||"kilometers")}function B(e,t,r){if(null==e)throw new Error("area is required");if(!(e>=0))throw new Error("area must be a positive number");var n=p[t||"meters"];if(!n)throw new Error("invalid original units");var o=p[r||"kilometers"];if(!o)throw new Error("invalid final units");return e/n*o}function D(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function R(e){return!!e&&e.constructor===Object}function F(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!D(e))throw new Error("bbox must only contain numbers")}))}function G(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}function X(){throw new Error("method has been renamed to `radiansToDegrees`")}function U(){throw new Error("method has been renamed to `degreesToRadians`")}function z(){throw new Error("method has been renamed to `lengthToDegrees`")}function Y(){throw new Error("method has been renamed to `lengthToRadians`")}function W(){throw new Error("method has been renamed to `radiansToLength`")}function Z(){throw new Error("method has been renamed to `bearingToAzimuth`")}function J(){throw new Error("method has been renamed to `convertLength`")}function V(e,t,r){if(null!==e)for(var n,o,i,a,s,u,l,c,f=0,d=0,h=e.type,g="FeatureCollection"===h,p="Feature"===h,m=g?e.features.length:1,y=0;y<m;y++){s=(c=!!(l=g?e.features[y].geometry:p?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var w=0;w<s;w++){var b=0,E=0;if(null!==(a=c?l.geometries[w]:l)){u=a.coordinates;var v=a.type;switch(f=!r||"Polygon"!==v&&"MultiPolygon"!==v?0:1,v){case null:break;case"Point":t(u,d,y,b,E),d++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++)t(u[n],d,y,b,E),d++,"MultiPoint"===v&&b++;"LineString"===v&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-f;o++)t(u[n][o],d,y,b,E),d++;"MultiLineString"===v&&b++,"Polygon"===v&&E++}"Polygon"===v&&b++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for("MultiPolygon"===v&&(E=0),o=0;o<u[n].length;o++){for(i=0;i<u[n][o].length-f;i++)t(u[n][o][i],d,y,b,E),d++;E++}b++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)V(a.geometries[n],t,r);break;default:throw new Error("Unknown Geometry Type")}}}}}function H(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)t(e.features[r],r)}function K(e){var t={type:"Feature"};return Object.keys(e).forEach((function(r){switch(r){case"type":case"properties":case"geometry":return;default:t[r]=e[r]}})),t.properties=function e(t){var r={};return t?(Object.keys(t).forEach((function(n){var o=t[n];"object"==typeof o?null===o?r[n]=null:o.length?r[n]=o.map((function(e){return e})):r[n]=e(o):r[n]=o})),r):r}(e.properties),t.geometry=Q(e.geometry),t}function Q(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((function(e){return Q(e)})),t):(t.coordinates=function e(t){if("object"!=typeof t[0])return t.slice();return t.map((function(t){return e(t)}))}(e.coordinates),t)}var $=function(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return K(e);case"FeatureCollection":return function(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach((function(r){switch(r){case"type":case"features":return;default:t[r]=e[r]}})),t.features=e.features.map((function(e){return K(e)})),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Q(e);default:throw new Error("unknown GeoJSON type")}};function ee(e,t){return re(e,"mercator",t)}function te(e,t){return re(e,"wgs84",t)}function re(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&D(e[0])?e="mercator"===t?ne(e):oe(e):(!0!==n&&(e=$(e)),V(e,(function(e){var r="mercator"===t?ne(e):oe(e);e[0]=r[0],e[1]=r[1]}))),e}function ne(e){var t,r=Math.PI/180,n=6378137,o=20037508.342789244,i=[n*(Math.abs(e[0])<=180?e[0]:e[0]-360*((t=e[0])<0?-1:t>0?1:0))*r,n*Math.log(Math.tan(.25*Math.PI+.5*e[1]*r))];return i[0]>o&&(i[0]=o),i[0]<-o&&(i[0]=-o),i[1]>o&&(i[1]=o),i[1]<-o&&(i[1]=-o),i}function oe(e){var t=180/Math.PI,r=6378137;return[e[0]*t/r,(.5*Math.PI-2*Math.atan(Math.exp(-e[1]/r)))*t]}var ie=function(e){var t=[1/0,1/0,-1/0,-1/0];return V(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t};function ae(e){if(!e)throw new Error("obj is required");var t=se(e);if(t.length>1&&D(t[0])&&D(t[1]))return t;throw new Error("Coordinate is not a valid Point")}function se(e){if(!e)throw new Error("obj is required");var t;if(e.length?t=e:e.coordinates?t=e.coordinates:e.geometry&&e.geometry.coordinates&&(t=e.geometry.coordinates),t)return function e(t){if(t.length>1&&D(t[0])&&D(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return e(t[0]);throw new Error("coordinates must only contain numbers")}(t),t;throw new Error("No valid coordinates")}function ue(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0;n<e.features.length;n++){var o=e.features[n];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+o.geometry.type)}}function le(e){if(!e)throw new Error("geojson is required");if(void 0!==e.geometry)return e.geometry;if(e.coordinates||e.geometries)return e;throw new Error("geojson must be a valid Feature or Geometry Object")}function ce(e,t){if(!e)throw new Error((t||"geojson")+" is required");if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error((t||"geojson")+" is invalid")}
/**
 * @license GNU Affero General Public License.
 * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 * v. 1.2.0
 * https://github.com/RaumZeit/MarchingSquares.js
 */var fe={successCallback:null,verbose:!1},de={};function he(e,t,r){r=r||{};for(var n=Object.keys(fe),o=0;o<n.length;o++){var i=n[o],a=r[i];a=null!=a?a:fe[i],de[i]=a}de.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+t);var s=function(e){var t=[],r=0;e.rows,e.cols;return e.cells.forEach((function(n,o){n.forEach((function(n,i){if(void 0!==n&&(5!==(d=n).cval&&10!==d.cval)&&!pe(n)){var a=function(e,t,r){var n,o,i,a=e.length,s=[],u=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],l=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],c=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],f=(e[t][r],e[t][r]),d=f.cval,h=ye(f,i=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][d]);s.push([r+h[0],t+h[1]]),h=ye(f,i=c[d]),s.push([r+h[0],t+h[1]]),me(f);var g=r+u[d],p=t+l[d],m=d;for(;g>=0&&p>=0&&p<a&&(g!=r||p!=t)&&void 0!==(f=e[p][g]);){if(0===(d=f.cval)||15===d)return{path:s,info:"mergeable"};i=c[d],n=u[d],o=l[d],5!==d&&10!==d||(5===d?f.flipped?-1===l[m]?(i="left",n=-1,o=0):(i="right",n=1,o=0):-1===u[m]&&(i="bottom",n=0,o=-1):10===d&&(f.flipped?-1===u[m]?(i="top",n=0,o=1):(i="bottom",n=0,o=-1):1===l[m]&&(i="left",n=-1,o=0))),h=ye(f,i),s.push([g+h[0],p+h[1]]),me(f),g+=n,p+=o,m=d}return{path:s,info:"closed"}}(e.cells,o,i),s=!1;if("mergeable"===a.info)for(var u=a.path[a.path.length-1][0],l=a.path[a.path.length-1][1],c=r-1;c>=0;c--)if(Math.abs(t[c][0][0]-u)<=1e-7&&Math.abs(t[c][0][1]-l)<=1e-7){for(var f=a.path.length-2;f>=0;--f)t[c].unshift(a.path[f]);s=!0;break}s||(t[r++]=a.path)}var d}))})),t}(function(e,t){for(var r=e.length-1,n=e[0].length-1,o={rows:r,cols:n,cells:[]},i=0;i<r;++i){o.cells[i]=[];for(var a=0;a<n;++a){var s=0,u=e[i+1][a],l=e[i+1][a+1],c=e[i][a+1],f=e[i][a];if(!(isNaN(u)||isNaN(l)||isNaN(c)||isNaN(f))){s|=u>=t?8:0,s|=l>=t?4:0,s|=c>=t?2:0;var d,h,g,p,m=!1;if(5===(s|=f>=t?1:0)||10===s){var y=(u+l+c+f)/4;5===s&&y<t?(s=10,m=!0):10===s&&y<t&&(s=5,m=!0)}if(0!==s&&15!==s)d=h=g=p=.5,1===s?(g=1-ge(t,u,f),h=1-ge(t,c,f)):2===s?(h=ge(t,f,c),p=1-ge(t,l,c)):3===s?(g=1-ge(t,u,f),p=1-ge(t,l,c)):4===s?(d=ge(t,u,l),p=ge(t,c,l)):5===s?(d=ge(t,u,l),p=ge(t,c,l),h=1-ge(t,c,f),g=1-ge(t,u,f)):6===s?(h=ge(t,f,c),d=ge(t,u,l)):7===s?(g=1-ge(t,u,f),d=ge(t,u,l)):8===s?(g=ge(t,f,u),d=1-ge(t,l,u)):9===s?(h=1-ge(t,c,f),d=1-ge(t,l,u)):10===s?(d=1-ge(t,l,u),p=1-ge(t,l,c),h=ge(t,f,c),g=ge(t,f,u)):11===s?(d=1-ge(t,l,u),p=1-ge(t,l,c)):12===s?(g=ge(t,f,u),p=ge(t,c,l)):13===s?(h=1-ge(t,c,f),p=ge(t,c,l)):14===s?(g=ge(t,f,u),h=ge(t,f,c)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+s),o.cells[i][a]={cval:s,flipped:m,top:d,right:p,bottom:h,left:g}}}}return o}(e,t));return"function"==typeof de.successCallback&&de.successCallback(s),s}function ge(e,t,r){return(e-t)/(r-t)}function pe(e){return 0===e.cval||15===e.cval}function me(e){pe(e)||5===e.cval||10===e.cval||(e.cval=15)}function ye(e,t){return"top"===t?[e.top,1]:"bottom"===t?[e.bottom,0]:"right"===t?[1,e.right]:"left"===t?[0,e.left]:void 0}function we(e,t){if(!R(t=t||{}))throw new Error("options is invalid");var r=t.zProperty||"elevation",n=t.flip,o=t.flags;ue(e,"Point","input must contain Points");for(var i=function(e,t){var r={};return H(e,(function(e){var t=se(e)[1];r[t]||(r[t]=[]),r[t].push(e)})),Object.keys(r).map((function(e){return r[e].sort((function(e,t){return se(e)[0]-se(t)[0]}))})).sort((function(e,r){return t?se(e[0])[1]-se(r[0])[1]:se(r[0])[1]-se(e[0])[1]}))}(e,n),a=[],s=0;s<i.length;s++){for(var u=i[s],l=[],c=0;c<u.length;c++){var f=u[c];f.properties[r]?l.push(f.properties[r]):l.push(0),!0===o&&(f.properties.matrixPosition=[s,c])}a.push(l)}return a}var be=function(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.zProperty||"elevation",o=r.commonProperties||{},i=r.breaksProperties||[];if(ue(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks must be an Array");if(!R(o))throw new Error("commonProperties must be an Object");if(!Array.isArray(i))throw new Error("breaksProperties must be an Array");var a=we(e,{zProperty:n,flip:!0});return _(function(e,t,r){var n=ie(r),o=n[2]-n[0],i=n[3]-n[1],a=n[0],s=n[1],u=t[0].length-1,l=t.length-1,c=o/u,f=i/l,d=function(e){e[0]=e[0]*c+a,e[1]=e[1]*f+s};return e.forEach((function(e){V(e,d)})),e}(function(e,t,r,n,o){for(var i=[],a=1;a<t.length;a++){var s=+t[a],u=Object.assign({},n,o[a]);u[r]=s;var l=M(he(e,s),u);i.push(l)}return i}(a,t,n,o,i),a,e))};const Ee=function(e){let t=_([S([[0,0],[1e6,1e6]])]);console.log("constructor",t);let r=JSON.stringify(t);this.source=new Bokeh.GeoJSONDataSource({geojson:r}),this.figure=e,this.figure.multi_line({xs:{field:"xs"},ys:{field:"ys"},line_color:"black",source:this.source})};Ee.prototype.render=function(e,t){let r=_(ve(e)),n=ee(be(r,t,{zProperty:"value"}));console.log(n),n.features=n.features.concat().filter(e=>e.geometry.coordinates.length>0),console.log(n),n.features.length>0&&(this.source.geojson=JSON.stringify(n),this.source.change.emit())};const ve=e=>{let t=[],r=e.dw/e.image.length,n=e.dh/e.image[0].length;for(let o=0;o<e.image.length;o++)for(let i=0;i<e.image[o].length;i++){let a=e.image[o][i],s=e.x+(.5+o)*r,u=e.y+(.5+i)*n;t.push(w([s,u],{value:a}))}return t};function Se(e,t,r,n){var o=r[0],i=r[1],a=e[0],s=e[1],u=t[0],l=t[1],c=u-a,f=l-s;return 0==(r[0]-a)*f-(r[1]-s)*c&&(n?"start"===n?Math.abs(c)>=Math.abs(f)?c>0?a<o&&o<=u:u<=o&&o<a:f>0?s<i&&i<=l:l<=i&&i<s:"end"===n?Math.abs(c)>=Math.abs(f)?c>0?a<=o&&o<u:u<o&&o<=a:f>0?s<=i&&i<l:l<i&&i<=s:"both"===n?Math.abs(c)>=Math.abs(f)?c>0?a<o&&o<u:u<o&&o<a:f>0?s<i&&i<l:l<i&&i<s:void 0:Math.abs(c)>=Math.abs(f)?c>0?a<=o&&o<=u:u<=o&&o<=a:f>0?s<=i&&i<=l:l<=i&&i<=s)}var Te=function(e,t,r){var n=(r=r||{}).ignoreEndVertices;if(!R(r))throw new Error("invalid options");if(!e)throw new Error("pt is required");if(!t)throw new Error("line is required");for(var o=ae(e),i=se(t),a=0;a<i.length-1;a++){var s=!1;if(n&&(0===a&&(s="start"),a===i.length-2&&(s="end"),0===a&&a+1===i.length-1&&(s="both")),Se(i[a],i[a+1],o,s))return!0}return!1};function _e(e,t,r){var n=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,i=t.length-1;o<t.length;i=o++){var a=t[o][0],s=t[o][1],u=t[i][0],l=t[i][1];if(e[1]*(a-u)+s*(u-e[0])+l*(e[0]-a)==0&&(a-e[0])*(u-e[0])<=0&&(s-e[1])*(l-e[1])<=0)return!r;s>e[1]!=l>e[1]&&e[0]<(u-a)*(e[1]-s)/(l-s)+a&&(n=!n)}return n}var Me=function(e,t,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.ignoreBoundary;if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var o=ae(e),i=se(t),a=t.geometry?t.geometry.type:t.type,s=t.bbox;if(s&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(o,s))return!1;"Polygon"===a&&(i=[i]);for(var u=0,l=!1;u<i.length&&!l;u++)if(_e(o,i[u][0],n)){for(var c=!1,f=1;f<i[u].length&&!c;)_e(o,i[u][f],!n)&&(c=!0),f++;c||(l=!0)}return l};function Pe(e,t){return!(e[0]>t[0])&&(!(e[2]<t[2])&&(!(e[1]>t[1])&&!(e[3]<t[3])))}function Ae(e,t){return e[0]===t[0]&&e[1]===t[1]}var ke=function(e,t){var r=ce(e),n=ce(t),o=le(e),i=le(t);switch(r){case"Point":switch(n){case"MultiPoint":return function(e,t){var r,n=!1;for(r=0;r<t.coordinates.length;r++)if(Ae(t.coordinates[r],e.coordinates)){n=!0;break}return n}(o,i);case"LineString":return Te(o,i,{ignoreEndVertices:!0});case"Polygon":return Me(o,i,{ignoreBoundary:!0});default:throw new Error("feature2 "+n+" geometry not supported")}case"MultiPoint":switch(n){case"MultiPoint":return function(e,t){for(var r=0;r<e.coordinates.length;r++){for(var n=!1,o=0;o<t.coordinates.length;o++)Ae(e.coordinates[r],t.coordinates[o])&&(n=!0);if(!n)return!1}return!0}(o,i);case"LineString":return function(e,t){for(var r=!1,n=0;n<e.coordinates.length;n++){if(!Te(e.coordinates[n],t))return!1;r||(r=Te(e.coordinates[n],t,{ignoreEndVertices:!0}))}return r}(o,i);case"Polygon":return function(e,t){for(var r=!0,n=0;n<e.coordinates.length;n++){var o=Me(e.coordinates[1],t);if(!o){r=!1;break}o=Me(e.coordinates[1],t,{ignoreBoundary:!0})}return r&&o}(o,i);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"LineString":return function(e,t){for(var r=0;r<e.coordinates.length;r++)if(!Te(e.coordinates[r],t))return!1;return!0}(o,i);case"Polygon":return function(e,t){var r=ie(t),n=ie(e);if(!Pe(r,n))return!1;for(var o=!1,i=0;i<e.coordinates.length-1;i++){if(!Me(e.coordinates[i],t))return!1;if(o||(o=Me(e.coordinates[i],t,{ignoreBoundary:!0})),!o){var a=(s=e.coordinates[i],u=e.coordinates[i+1],[(s[0]+u[0])/2,(s[1]+u[1])/2]);o=Me(a,t,{ignoreBoundary:!0})}}var s,u;return o}(o,i);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"Polygon":return function(e,t){var r=ie(e);if(!Pe(ie(t),r))return!1;for(var n=0;n<e.coordinates[0].length;n++)if(!Me(e.coordinates[0][n],t))return!1;return!0}(o,i);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}};var xe=function(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.units,o=ae(e),i=ae(t),a=q(i[1]-o[1]),s=q(i[0]-o[0]),u=q(o[1]),l=q(i[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return j(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n)};var je=function(e,t,r){if(!R(r=r||{}))throw new Error("options is invalid");var n=r.mask,o=r.properties,i=[];if(null==t)throw new Error("cellSide is required");if(!D(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(n&&-1===["Polygon","MultiPolygon"].indexOf(ce(n)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=e[0],s=e[1],u=e[2],l=e[3],c=t/xe([a,s],[u,s],r)*(u-a),f=t/xe([a,s],[a,l],r)*(l-s),d=u-a,h=l-s,g=Math.floor(d/c),p=(h-Math.floor(h/f)*f)/2,m=a+(d-g*c)/2;m<=u;){for(var y=s+p;y<=l;){var b=w([m,y],o);n?ke(b,n)&&i.push(b):i.push(b),y+=f}m+=c}return _(i)};window.isolines=be,window.pointGrid=je,window.helpers=n,window.projection=o,window.contour=i;let Ie={Antique:"https://cartocdn_d.global.ssl.fastly.net/base-antique/{Z}/{X}/{Y}.png","Midnight Commander":"https://cartocdn_d.global.ssl.fastly.net/base-midnight/{Z}/{X}/{Y}.png","ESRI Nat Geo":"https://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{Z}/{Y}/{X}",Voyager:"https://d.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{Z}/{X}/{Y}.png"};let Le=e=>({type:"SET_PALETTE",payload:e}),Ce=e=>({type:"SET_PALETTE_NAME",payload:e}),Oe=e=>({type:"SET_PALETTE_NUMBER",payload:e}),qe=e=>({type:"SET_TIME_INDEX",payload:e}),Ne=(e="",t)=>{switch(t.type){case"SET_DATASET":return Object.assign({},e,{dataset:t.payload});case"SET_DATASETS":return Object.assign({},e,{datasets:t.payload});case"SET_URL":return Object.assign({},e,{url:t.payload});case"SET_PALETTE":return Object.assign({},e,{palette:t.payload});case"SET_PALETTES":return Object.assign({},e,{palettes:t.payload});case"SET_PALETTE_NAME":return Object.assign({},e,{palette_name:t.payload});case"SET_PALETTE_NAMES":return Object.assign({},e,{palette_names:t.payload});case"SET_PALETTE_NUMBER":return Object.assign({},e,{palette_number:t.payload});case"SET_PALETTE_NUMBERS":return Object.assign({},e,{palette_numbers:t.payload});case"SET_PLAYING":return Object.assign({},e,{playing:t.payload});case"SET_LIMITS":return Object.assign({},e,{limits:t.payload});case"SET_TIMES":return Object.assign({},e,{times:t.payload});case"SET_TIME_INDEX":return Object.assign({},e,{time_index:t.payload});case"FETCH_IMAGE":return Object.assign({},e,{is_fetching:!0,image_url:t.payload});case"FETCH_IMAGE_SUCCESS":return Object.assign({},e,{is_fetching:!1});default:return e}},Be=e=>e=>t=>{e(t)},De=e=>t=>r=>{if("NEXT_TIME_INDEX"===r.type){let r=e.getState();if(void 0===r.time_index)return;if(void 0===r.times)return;let n=Ge(r.time_index+1,r.times.length),o=qe(n);t(o)}else if("PREVIOUS_TIME_INDEX"===r.type){let r=e.getState();if(void 0===r.time_index)return;if(void 0===r.times)return;let n=Ge(r.time_index-1,r.times.length),o=qe(n);t(o)}else t(r)},Re=e=>t=>r=>{if("SET_PALETTE_NAME"==r.type){let t=r.payload,n=e.getState();if(void 0!==n.palettes){let r=n.palettes.filter(e=>e.name==t).map(e=>parseInt(e.number)).concat().sort((e,t)=>e-t),o={type:"SET_PALETTE_NUMBERS",payload:r};e.dispatch(o)}}else if("SET_PALETTE_NUMBER"==r.type){let t=e.getState(),n=t.palette_name,o=r.payload;if(void 0!==t.palettes){let r=Xe(t.palettes,n,o);if(r.length>0){let t=Le(r[0].palette);e.dispatch(t)}}}else if("SET_PALETTES"==r.type){t(r),t(Ce("Blues")),t(Oe(256));let e=Xe(r.payload,"Blues",256);if(e.length>0){let r=Le(e[0].palette);t(r)}return}return t(r)},Fe=e=>e=>t=>{if(e(t),"SET_DATASETS"==t.type){let r=t.payload[0];e((e=>({type:"SET_DATASET",payload:e}))(r))}},Ge=function(e,t){return(e%t+t)%t},Xe=function(e,t,r){return e.filter(e=>e.name===t).filter(e=>parseInt(e.number)===parseInt(r))};function Ue(e,t){this.figure=e,this.source=new Bokeh.ColumnDataSource({data:{xs:[[]],ys:[[]]}}),this.figure.multi_line({xs:{field:"xs"},ys:{field:"ys"},line_color:t,source:this.source})}function ze(e){this.el=e}function Ye(e){this.button=document.createElement("button"),this.button.classList.add("lite-btn","play-btn"),this.i=document.createElement("i"),this.i.classList.add("fas","fa-play"),this.button.appendChild(this.i),this.button.onclick=e.onClick,this.el=this.button}function We(e){let t,r;t=document.createElement("button"),t.classList.add("lite-btn","previous-btn"),t.onclick=e.onClick,r=document.createElement("i"),r.classList.add("fas","fa-angle-left"),t.appendChild(r),this.el=t}function Ze(e){let t,r;t=document.createElement("button"),t.classList.add("lite-btn","next-btn"),t.onclick=e.onClick,r=document.createElement("i"),r.classList.add("fas","fa-angle-right"),t.appendChild(r),this.el=t}window.main=function(){let e=new Bokeh.Range1d({start:0,end:1e6}),t=new Bokeh.Range1d({start:0,end:1e6}),r=Bokeh.Plotting.figure({x_range:e,y_range:t,sizing_mode:"stretch_both"});r.xaxis[0].visible=!1,r.yaxis[0].visible=!1,r.toolbar_location=null,r.min_border=0,r.select_one(Bokeh.WheelZoomTool).active=!0;let n=new Bokeh.WMTSTileSource({url:"https://cartocdn_d.global.ssl.fastly.net/base-antique/{Z}/{X}/{Y}.png"}),o=new Bokeh.TileRenderer({tile_source:n});r.renderers=r.renderers.concat(o),Bokeh.Plotting.show(r,"#map-figure");let i=Redux.createStore(Ne,Redux.applyMiddleware(Be,De,Re,Fe));i.subscribe(()=>{let e=i.getState();void 0!==e.url&&(n.url=e.url)}),fetch("./palettes").then(e=>e.json()).then(e=>{let t={type:"SET_PALETTES",payload:e};return i.dispatch(t),e}).then(e=>{let t=e.map(e=>e.name);return Array.from(new Set(t)).concat().sort()}).then(e=>{let t={type:"SET_PALETTE_NAMES",payload:e};i.dispatch(t)});let a=new Bokeh.Widgets.Select({options:Object.keys(Ie)});a.connect(a.properties.value.change,()=>{i.dispatch({type:"SET_URL",payload:Ie[a.value]})}),Bokeh.Plotting.show(a,"#tile-url-select");let s=new Bokeh.Widgets.Select({options:[]});s.connect(s.properties.value.change,()=>{i.dispatch({type:"SET_DATASET",payload:s.value})}),Bokeh.Plotting.show(s,"#select"),i.subscribe(()=>{let e=i.getState();void 0!==e.datasets&&void 0!==e.dataset&&(s.options=e.datasets,s.value=e.dataset)}),fetch("./datasets").then(e=>e.json()).then(e=>{i.dispatch({type:"SET_DATASETS",payload:e.names})});let u=new Bokeh.Widgets.Select({options:[]});i.subscribe(()=>{let e=i.getState();void 0!==e.palette_names&&(u.options=e.palette_names)}),u.connect(u.properties.value.change,()=>{let e=Ce(u.value);i.dispatch(e)}),Bokeh.Plotting.show(u,"#palette-select");let l=new Bokeh.Widgets.Select({options:[]});i.subscribe(()=>{let e=i.getState();if(void 0!==e.palette_numbers){let t=e.palette_numbers.map(e=>e.toString());l.options=t}}),l.connect(l.properties.value.change,()=>{let e=Oe(l.value);i.dispatch(e)}),Bokeh.Plotting.show(l,"#palette-number-select");let c=new Bokeh.LinearColorMapper({low:200,high:300,palette:["#440154","#208F8C","#FDE724"],nan_color:"rgba(0,0,0,0)"});i.subscribe(()=>{let e=i.getState();void 0!==e.palette&&(c.palette=e.palette),void 0!==e.limits&&(c.low=e.limits.low,c.high=e.limits.high)});let f=new Ee(r),d=[];for(let e=0;e<10;e++){let t=100+20*e;d.push(t)}let h=[];for(let e=0;e<256;e++){let t=[];for(let r=0;r<256;r++){let r=e/256*300;t.push(r)}h.push(t)}f.render({x:0,y:0,dw:10,dh:10,image:h},d);let g=new ze(document.getElementById("title-text"));i.subscribe(()=>{let e=i.getState();if(void 0===e.time_index)return;if(void 0===e.times)return;let t=new Date(e.times[e.time_index]);g.render(t.toUTCString())}),i.dispatch(qe(0)),fetch("./datasets/EIDA50/times?limit=10").then(e=>e.json()).then(e=>{let t={type:"SET_TIMES",payload:e};i.dispatch(t)});let p=()=>{let e=i.getState();if(!e.is_fetching&&e.playing){let e={type:"NEXT_TIME_INDEX"};i.dispatch(e)}},m=document.getElementById("controls"),y=document.createElement("div");y.classList.add("btn-row"),m.appendChild(y);let w=new We({onClick:()=>{let e={type:"PREVIOUS_TIME_INDEX"};i.dispatch(e)}});y.appendChild(w.el);let b=new Ye({onClick:function(){let e;e=!i.getState().playing;let t=(e=>({type:"SET_PLAYING",payload:e}))(e);i.dispatch(t)}});i.subscribe(()=>{let e=i.getState();b.render(e.playing)}),y.appendChild(b.el);let E=new Ze({onClick:()=>{let e={type:"NEXT_TIME_INDEX"};i.dispatch(e)}});y.appendChild(E.el);p(),setInterval(p,100),new Ue(r,"black").fetch("./atlas/coastlines"),new Ue(r,"black").fetch("./atlas/borders"),new Ue(r,"red").fetch("./atlas/disputed"),new Ue(r,"LightBlue").fetch("./atlas/lakes")},Ue.prototype.fetch=function(e){fetch(e).then(e=>e.json()).then(e=>{this.source.data=e})},ze.prototype.render=function(e){this.el.innerHTML=e},Ye.prototype.render=function(e){e?(this.i.classList.remove("fas","fa-play"),this.i.classList.add("fas","fa-pause")):(this.i.classList.remove("fas","fa-pause"),this.i.classList.add("fas","fa-play"))}}]);